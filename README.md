# transfer_matrix_mode_soluter
求解1D模式
更新v1.1:
由于衬底折射率为1时远小于材料，导致γ在空气中很小，虽然Az收敛至很小，但随着距离很快光场发散。继续减小Az值意义不大，对材料内光场影响很小，因此调整为在求电场时在衬底中不包含Az项
加入了限制因子的计算

#######################
更新v1.1.1：
改善了预求解时tan函数发散导致的报错问题
限制因子计算时的有源区现在可以有多层

#######################
更新v1.2：
通过Maxwell方程，在波导解下推导得知，无论是否漏模，电场的导数也必须是连续的，因此在酋解器v1.1.1基础上应该可以通过迭代至Az=0得到正确的漏模解。结果发现，只有给衬底设置一个吸收，或者给有源区设置一个足够大的增益，才能求出合理的漏模解。现在，通过倍增增益的方法，在初次求解漏模问题收敛失败时，不断给有源区增加增益，最终可以得到漏模解。下一步希望继续微调迭代这个增益值，使得解的净增益为0，这样可以测得漏模的损耗。
主要原因在于，如果解为单向平面波漏模，则在衬底以上的区域中必须有净的向上的动量才能保证动量守恒（Maxwell方程蕴含了动量守恒，只有动量守恒才能成为其解），因此有源区的增益，即折射率的虚部可以导致原本的cos或sin解分解出的向上向下平面波的振幅不再相等，使得有净向上的动量。物理上，这对应着波导中向上反射的全反射波不再等于向下入射的，而有一部分损耗（即折射光漏光）。
此外，又重新在画图时增加了Az项，但是这次设置了画图时衬底的最大厚度，避免光场发散。
现在有漏模时会计算相应损耗并打印。预计后面开发远场酋解器，以及增益波导效应

#######################
更新v1.2：
改进使用downhill法迭代有源区折射率虚部（即增益），使得获得稳态解的效率与稳定性更高。
现在文件输出复数电场，可以从输出结果绘制远场。

#######################
更新v2.0：
对structure文件分块

#######################
更新v1.3：
有些时候，特别是当波导和CL折射率差异很小时，而且存在衬底时，可能虽然有效折射率实部大于衬底（即不产生漏模），但这个波导无法支持该波长的模式（即无源时求解不收敛）。此时只有增加适当的增益才能形成导模（gain-guide模式），而此时无法继续缩小增益使得总有效折射率虚部为0（像泄露模式那样）。现在酋解器会在这种情况下输出，需要增益波导模式，并给出最少需要的增益值。

#######################
更新v3.0：
酋解器v3.0在计算存在漏模的情况时，依然采用给有源区增加虚增益的方式估算漏模的强度。在增加虚增益时，不会考虑有源区折射率实部的改变，因为
这是虚增益，只是用来抵消漏模用的，因此如果考虑anti-guiding效应，应该在有源区初始的折射率设置中就调整实部。计算结果在估计漏模损耗时会减去初始的折射率虚部。
我们发现我们的方法与Muziol等人采用唯象边界条件的方法估算出的漏模损耗有所出入，但趋势和数量级相差不大。这更可能是Muziol文章中的结构与实际结构有所偏差导致的。
此外，我们发现不给有源区虚增益，而是直接给有效折射率试探解加入虚部的方式不能使得漏模存在时的求解收敛。
增加了远场计算。

#######################
更新v3.1：
修复了一个潜在的bug，当求解存在多解时，会在求解第一个解后将折射率重置，防止因为虚增益导致的有源区折射率改变。
